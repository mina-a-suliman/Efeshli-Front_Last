@if (isLoading) {
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading your cart...</p>
  </div>
} @else if (errorMessage) {
  <div class="error-container">
    <h2>Unable to load cart</h2>
    <p>{{ errorMessage }}</p>
    <button class="retry-btn" (click)="loadCart()">Try Again</button>
  </div>
} @else if ((serverCart?.items?.length ?? 0) === 0) {
  <div class="empty-cart-items-container">
    <img src="./assets/Cart-Items.png" alt="Empty Cart Items" class="cart-items-image">
    <h1 class="cart-items-title">Your shopping cart looks empty</h1>
    <p class="cart-items-subtitle">What are you waiting for?</p>
    <button class="start-shopping-items-btn" (click)="startShopping()">Start shopping now</button>
  </div>
} @else {
  <div class="cart-container">
    <div class="cart-content">
      <!-- Cart Header -->
      <div class="cart-header">
        <h1 class="cart-title">CART</h1>
        <button class="download-btn">
          Download Cart
        </button>
        <!-- <button class="download-btn" (click)="downloadCart()">
          Download Cart
        </button> -->
      </div>

      <!-- Cart Items -->
      @if ((serverCart?.items?.length ?? 0) > 0) {
        <div class="cart-items">
          @for (item of serverCart?.items; track item.cartItemId; let i = $index) {
            <div class="cart-item">
              <div class="left">
                <div class="item-image">
                  <img [src]="item.imageUrls.at(0)" [alt]="item.productName" />
                  @if (item.discount > 0) {
                    <div class="discount-badge">{{ item.discount }}% Off</div>
                  }
                </div>
              
                <div class="info">
<p class="item-name">{{ item.productName }}</p>

                <!-- <div class="item-status" [class.ready-to-ship]="item.readyToShip" [class.made-to-order]="!item.readyToShip">
                  <span class="status-text">{{ item.readyToShip ? 'Ready to Ship' : 'Made to Order' }}</span>
                </div> -->

                <p class="item-dimensions">{{ item.dimensionsOrSize }}</p>
                </div>
                
              </div>
              

              <div class="center">
                <div class="quantity-section">
                    <label class="quantity-label">Quantity</label>
                    <div class="quantity-input">
                      <select 
                        id="quantity"
                        class="custom-select"
                        [ngModel]="item.quantity"
                        (ngModelChange)="updateQuantity(item, $event)">
                        @for (qty of quantities; track qty) {
                          <option [value]="qty">{{ qty }}</option>
                        }
                      </select>
                      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevrons-up-down ms-2 size-4 shrink-0 opacity-50" aria-hidden="true">
                        <path d="m7 15 5 5 5-5"></path>
                        <path d="m7 9 5-5 5 5"></path>
                      </svg>
                    </div>
                  </div>
              </div>

              <div class="right">
                <div class="price-section">
                    <div class="price-container">
                      <span class="current-price">{{ item.price * item.quantity | number:'1.0-0' }} <sup>EGP</sup></span>
                    </div>
                  </div>

                  <button class="remove-btn" (click)="removeItem(item)">                    
                    Remove
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3,6 5,6 21,6"></polyline>
                      <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                      <line x1="10" y1="11" x2="10" y2="17"></line>
                      <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                  </button>
              </div>
            </div>
          }
        </div>
      }
    </div>

    <!-- Cart Summary Sidebar -->
    <div class="cart-summary">
      <div class="summary-box">
        <h2 class="summary-title">Cart Summary</h2>

        @for (item of serverCart?.items; track item.cartItemId) {
          <div class="summary-item">
            <span class="summary-item-name">{{ item.productName }}</span>
            <span class="summary-item-price">{{ item.price * item.quantity | number:'1.0-0' }} <sup>EGP</sup></span>
          </div>
        }

        <div class="summary-calculations">
          <div class="summary-row">
            <span class="label">Subtotal</span>
            <span class="value">{{ subtotal | number:'1.0-0' }} <sup>EGP</sup></span>
          </div>

          <div class="summary-row vat-row">
            <span class="label">VAT ({{ vatRate }}%)</span>
            <span class="value included">Included in the products</span>
          </div>

          <div class="summary-row">
            <span class="label">Shipping</span>
            <span class="value">{{ shippingMessage }}</span>
          </div>

          <div class="summary-row total-row">
            <span class="label">Total</span>
            <span class="totalPrice">{{ total | number:'1.0-0' }} <sup>EGP</sup></span>
          </div>
        </div>

        <button class="checkout-btn" (click)="proceedToCheckout()">
          Proceed To Checkout
        </button>

      </div>
      <div class="split-delivery">
        <p class="split-delivery-text"> <span> <svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.5 19H5.5C4.5 19 3.5 18 3.5 17V7C3.5 6 4.5 5 5.5 5H8.5" stroke="#C40101" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"></path><path d="M16.5 5H19.5C20.5 5 21.5 6 21.5 7V17C21.5 18 20.5 19 19.5 19H16.5" stroke="#C40101" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"></path><path d="M12.5 4V20" stroke="#C40101" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"></path></svg> Want to split your delivery?</span> See more in the next step.</p>
      </div>

      <div class="help-section">
        <p class="help-text">Need some help? We got you.</p>
        <div class="contact-options">
          <button class="contact-btn phone" (click)="contactSupport('phone')">
            üìû +20 100 074 8719
          </button>
          <button class="contact-btn email" (click)="contactSupport('email')">
            ‚úâÔ∏è hello@efreshii.com
          </button>
        </div>
      </div>
    </div>
  </div>
}
