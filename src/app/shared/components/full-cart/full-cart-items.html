@if (isLoading) {
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading your cart...</p>
  </div>
} @else if (errorMessage) {
  <div class="error-container">
    <h2>Unable to load cart</h2>
    <p>{{ errorMessage }}</p>
    <button class="retry-btn" (click)="loadCart()">Try Again</button>
  </div>
} @else if (!cartItems || cartItems.length<=0) { 
  <div class="empty-cart-items-container">
    <img src="./assets/Cart-Items.png" alt="Empty Cart Items" class="cart-items-image">
    <h1 class="cart-items-title">Your shopping cart looks empty</h1>
    <p class="cart-items-subtitle">What are you waiting for?</p>
    <button class="start-shopping-items-btn" (click)="startShopping()">Start shopping now</button>
  </div>
} @else {
  <!-- shared/full-cart/full-cart.component.html -->
  <div class="cart-container">
    <div class="cart-content">
      <!-- Cart Header -->
      <div class="cart-header">
        <h1 class="cart-title">CART</h1>
        <button class="download-btn" (click)="downloadCart()">
          Download Cart
        </button>
      </div>

      <!-- Cart Items -->
      @if (cartItems.length > 0) {
        <div class="cart-items">
          @for (item of cartItems; track item.id; let i = $index) {
            <div class="cart-item">
              <div class="item-image">
                <img [src]="item.imageUrl" [alt]="item.name" />
                <!-- Discount Badge -->
                @if (i === 0 || i === 3) {
                  <div class="discount-badge">
                    {{ i === 0 ? '25% Off' : '20% Off' }}
                  </div>
                }
              </div>

              <div class="item-details">
                <h3 class="item-name">{{ item.name }}</h3>

                <div class="item-status" [class.ready-to-ship]="item.readyToShip" [class.made-to-order]="!item.readyToShip">
                  <span class="status-text">{{ item.readyToShip ? 'Ready to Ship' : 'Made to Order' }}</span>
                </div>

                <p class="item-dimensions">{{ getItemDimensions(i) }}</p>

                <div class="item-controls">
                  <div class="quantity-section">
                    <label class="quantity-label">Quantity</label>
                    <div class="quantity-input">
                      <select 
                        id="quantity"
                        class="custom-select"
                        [(ngModel)]="item.quantity"
                        (ngModelChange)="updateQuantity(item, $event)">
                        @for (qty of quantities; track qty) {
                          <option [value]="qty">
                            {{ qty }}
                          </option>
                        }
                      </select>
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-chevrons-up-down ms-2 size-4 shrink-0 opacity-50" aria-hidden="true">
                        <path d="m7 15 5 5 5-5"></path>
                        <path d="m7 9 5-5 5 5"></path>
                      </svg>
                    </div>
                  </div>

                  <div class="price-section">
                    <div class="price-container">
                      @if (i === 0 || i === 3) {
                        <span class="original-price">{{ getOriginalPrice(i) }} EGP</span>
                      }
                      <span class="current-price">{{ item.price * item.quantity | number:'1.0-0' }} EGP</span>
                    </div>
                  </div>

                  <button class="remove-btn" (click)="removeItem(item.id)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="3,6 5,6 21,6"></polyline>
                      <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
                      <line x1="10" y1="11" x2="10" y2="17"></line>
                      <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                    Remove
                  </button>
                </div>
              </div>
            </div>
          }
        </div>
      }

      <!-- Empty Cart Message -->
      @if (cartItems.length === 0) {
        <div class="empty-cart">
          <p>Your cart is empty</p>
        </div>
      }
    </div>

    <!-- Cart Summary Sidebar -->
    <div class="cart-summary">
      <div class="summary-box">
        <h2 class="summary-title">Cart Summary</h2>

        @for (item of cartItems; track item.id) {
          <div class="summary-item">
            <span class="summary-item-name">{{ item.name }}</span>
            <span class="summary-item-price">{{ item.price * item.quantity | number:'1.0-0' }} EGP</span>
          </div>
        }

        <div class="summary-calculations">
          <div class="summary-row">
            <span class="label">Subtotal</span>
            <span class="value">{{ subtotal | number:'1.0-0' }} EGP</span>
          </div>

          <div class="summary-row vat-row">
            <span class="label">VAT ({{ vatRate }}%)</span>
            <span class="value included">Included in the products</span>
          </div>

          <div class="summary-row">
            <span class="label">Shipping</span>
            <span class="value">{{ shippingMessage }}</span>
          </div>

          <div class="summary-row total-row">
            <span class="label">Total</span>
            <span class="value">{{ total | number:'1.0-0' }} EGP</span>
          </div>
        </div>

        <button class="checkout-btn" (click)="proceedToCheckout()">
          Proceed To Checkout
        </button>
        
        <!-- Split Delivery Section -->
        <div class="split-delivery">
          <p class="split-delivery-text">Want to split your delivery? See more in the next step.</p>
        </div>
      </div>

      <div class="help-section">
        <p class="help-text">Need some help? We got you.</p>
        <div class="contact-options">
          <button class="contact-btn phone" (click)="contactSupport('phone')">
            üìû +20 100 074 8719
          </button>
          <button class="contact-btn email" (click)="contactSupport('email')">
            ‚úâÔ∏è hello@efreshii.com
          </button>
        </div>
      </div>
    </div>
  </div>
}