<div class="container py-4">
  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading products...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="alert alert-danger" role="alert">
    {{error}}
    <button class="btn btn-sm btn-outline-danger ms-2" (click)="loadProducts()">
      Retry
    </button>
  </div>

  <!-- Content -->
  <div *ngIf="!loading && !error">
    <div class="row">
      <div class="head col-12">
        <h6>Shop</h6>
        <div>
          <a href="#">Home</a>
          <span> > </span>
          <a href="#">Shop</a>
        </div>
      </div>
    </div>
    
    <div class="row">
      <!-- Filters Sidebar -->
      <div class="col-lg-3">
        
<!-- Categories Section -->
<div class="filter-section">
  <div class="filter-header" (click)="toggleFilterSection('category')">
    <h5 class="filter-title">Categories</h5>
    <i class="bi" 
       [class.bi-plus]="!filterSections?.categoryOpen" 
       [class.bi-dash]="filterSections?.categoryOpen"></i>
  </div>
  
  <div class="filter-content" *ngIf="filterSections?.categoryOpen">
    <!-- Loading State -->
    <div *ngIf="loadingCategories" class="text-center py-2">
      <div class="spinner-border spinner-border-sm" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <!-- Categories List -->
    <div *ngIf="!loadingCategories">
      <div class="category-item" *ngFor="let category of categories">
       
        <!-- Parent Category -->
        <div class="category-row" 
             [class.selected]="filters?.selectedCategoryId === category.categoryId"
             [class.has-subcategories]="category.hasSubCategories"
             (click)="toggleCategory(category)">
          
          <span class="category-text">{{category.name}}</span>
          
          <div class="category-actions">
            <!-- Radio for categories without subcategories -->
            <input *ngIf="!category.hasSubCategories"
                   type="radio" 
                   name="category"
                   [checked]="filters?.selectedCategoryId === category.categoryId"
                   (click)="$event.stopPropagation()">
            
            <!-- Expand/Collapse Icon -->
             
            <i *ngIf="category.hasSubCategories" 
               class="bi" 
               [class.bi-chevron-right]="!category.expanded" 
               [class.bi-chevron-down]="category.expanded"></i>
          </div>
        </div>

        <!-- Subcategories -->
        <!-- Subcategories -->
        <div *ngIf="category.expanded && category.hasSubCategories" class="subcategories">
          <!-- Loading Subcategories -->
          <div *ngIf="isLoadingSubcategories(category.categoryId)" class="text-center py-2">
            <div class="spinner-border spinner-border-sm" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>

          <!-- Subcategories List -->
          <div class="subcategory-item" *ngFor="let subcategory of getSubcategories(category.categoryId)">
            <div class="filter-option" 
                [class.selected]="filters?.selectedSubcategoryId == subcategory.categoryId"
                (click)="selectSubcategory(subcategory.categoryId)">
              <input 
                type="radio" 
                name="subcategory"
                [checked]="filters?.selectedSubcategoryId == subcategory.categoryId">
              <span>{{subcategory.name}}</span>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>


       <!-- Categories Section -->

        <!-- Brands Section -->
        <div class="filter-section">
          <div class="filter-header" (click)="toggleFilterSection('brand')">
            <h5 class="filter-title">Brands</h5>
            <i class="bi" 
               [class.bi-chevron-down]="!filterSections.brandOpen" 
               [class.bi-chevron-up]="filterSections.brandOpen"></i>
          </div>
          <div class="filter-content" *ngIf="filterSections.brandOpen">
            <div class="filter-option" *ngFor="let brand of brands">
              <input 
                type="checkbox" 
                [id]="'brand-' + brand.id" 
                [checked]="isBrandSelected(brand.id)"
                (change)="toggleBrand(brand.id)">
              <label [for]="'brand-' + brand.id">
                {{brand.name}} <span class="filter-count">({{brand.count}})</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Fabric Colors Section -->
        <div class="filter-section">
          <div class="filter-header" (click)="toggleFilterSection('fabricColor')">
            <h5 class="filter-title">Fabric Colors</h5>
            <i class="bi" 
               [class.bi-chevron-down]="!filterSections.fabricColorOpen" 
               [class.bi-chevron-up]="filterSections.fabricColorOpen"></i>
          </div>
          <div class="filter-content" *ngIf="filterSections.fabricColorOpen">
            <div class="color-option" *ngFor="let color of fabricColors">
              <div class="color-box" 
                   [style.background-color]="color.hexCode"
                   [class.selected]="isFabricColorSelected(color.id)"
                   (click)="selectFabricColor(color.id)">
              </div>
              <span>{{color.name}}</span>
            </div>
          </div>
        </div>

        <!-- Wood Colors Section -->
        <div class="filter-section">
          <div class="filter-header" (click)="toggleFilterSection('woodColor')">
            <h5 class="filter-title">Wood Colors</h5>
            <i class="bi" 
               [class.bi-chevron-down]="!filterSections.woodColorOpen" 
               [class.bi-chevron-up]="filterSections.woodColorOpen"></i>
          </div>
          <div class="filter-content" *ngIf="filterSections.woodColorOpen">
            <div class="color-option" *ngFor="let color of woodColors">
              <div class="color-box" 
                   [style.background-color]="color.hexCode"
                   [class.selected]="isWoodColorSelected(color.id)"
                   (click)="selectWoodColor(color.id)">
              </div>
              <span>{{color.name}}</span>
            </div>
          </div>
        </div>

        <!-- Price Range Section -->
        <!-- Price Range Section -->



        <!-- Clear Filters Button -->
        <div class="filter-section">
          <button class="btn btn-outline-primary w-100" (click)="clearAllFilters()">
            Clear All Filters
          </button>
        </div>
      </div>

      <!-- Products Column -->
      <div class="col-lg-9">
        <!-- Sort Controls -->
        <div class="sort-by d-flex justify-content-between align-items-center mb-4">
          <div class="results-info">
            <span class="results-count"></span>
          </div>
          <div class="sort-controls d-flex align-items-center">
            <span class="me-2">Sort By:</span>
            <select class="form-select" style="width: auto;" 
                    [(ngModel)]="selectedSort" (change)="onSortChange()">
              <option *ngFor="let option of sortOptions" [value]="option.value">
                {{option.label}}
              </option>
            </select>
          </div>
        </div>
        
        <!-- Products Grid -->
        <!-- Products Grid -->
<div class="row" *ngIf="products.length > 0">
  <div class="col-lg-4 col-md-6 mb-4" *ngFor="let product of products">
    <div class="product-card-wrapper" style="position: relative;">
      <!-- Product Card -->
      <app-product-card 
          [product]="product"
          [showHeartButton]="true"
          [wishlistLists]="wishlistLists"
          [showWishlistDropdown]="false"
          [wishlistStatusLoaded]="true"
          (wishlistChanged)="onProductWishlistChanged($event)">
      </app-product-card>
      <div class="heart-button-overlay">
        <app-product-heart-button
            [productId]="product.productId"
            [size]="'medium'"
            [position]="'top-right'"
            [mode]="'dropdown'"
            [initialWishlistStatus]="product.isWishlisted || product.isInWishlist || false"
            (wishlistToggled)="onProductWishlistChanged({ productId: $event.productId, inWishlist: $event.added })">
        </app-product-heart-button>
      </div>
  
    </div>
  </div>
</div>

<!-- Global Wishlist Dropdown -->
<app-wishlist-dropdown
    *ngIf="showWishlistDropdown && selectedProductForWishlist && (selectedProductForWishlist.productId || selectedProductForWishlist.id)"
    [productId]="selectedProductForWishlist.productId ?? selectedProductForWishlist.id ?? 0"
    [isVisible]="showWishlistDropdown"
    (close)="onWishlistDropdownClose()"
    (itemAdded)="onWishlistItemAdded($event)"
    (itemRemoved)="onWishlistItemRemoved($event)">
</app-wishlist-dropdown>
        <!-- No Products Found -->
        <div *ngIf="products.length === 0" class="text-center py-5">
          <h5>No products found</h5>
          <p>Try adjusting your filters or search terms.</p>
        </div>

        <!-- Pagination -->
        <div class="pagination-container" *ngIf="totalPages > 1">
          <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
              <!-- Previous Button -->
              <li class="page-item" [class.disabled]="!hasPreviousPage">
                <a class="page-link" (click)="previousPage()" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>
              
              <!-- First Page -->
              <li class="page-item" *ngIf="getPageNumbers().length > 0 && getPageNumbers()[0] > 1">
                <a class="page-link" (click)="goToPage(1)">1</a>
              </li>
              <li class="page-item" *ngIf="getPageNumbers().length > 0 && getPageNumbers()[0] > 2">
                <span class="page-link">...</span>
              </li>
              
              <!-- Page Numbers -->
              <li class="page-item" *ngFor="let page of getPageNumbers()" 
                  [class.active]="currentPage === page">
                <a class="page-link" (click)="goToPage(page)">{{page}}</a>
              </li>
              
              <!-- Last Page -->
              <li class="page-item" *ngIf="getPageNumbers().length > 0 && getPageNumbers()[getPageNumbers().length - 1] < totalPages - 1">
                <span class="page-link">...</span>
              </li>
              <li class="page-item" *ngIf="getPageNumbers().length > 0 && getPageNumbers()[getPageNumbers().length - 1] < totalPages">
                <a class="page-link" (click)="goToPage(totalPages)">{{totalPages}}</a>
              </li>
              
              <!-- Next Button -->
              <li class="page-item" [class.disabled]="!hasNextPage">
                <a class="page-link" 
                  (click)="hasNextPage ? nextPage() : null" 
                  [style.cursor]="hasNextPage ? 'pointer' : 'not-allowed'"
                  aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>
            </ul>
          </nav>
          
          <!-- Page Info -->
          <div class="text-center mt-2">
            <small class="text-muted">
              Page {{currentPage}} of {{totalPages}} 
              ({{totalCount}} total products)
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>