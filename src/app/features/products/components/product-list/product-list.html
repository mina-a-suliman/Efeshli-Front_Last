<div class="container py-4">
  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading products...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="alert alert-danger" role="alert">
    {{error}}
    <button class="btn btn-sm btn-outline-danger ms-2" (click)="loadProducts()">
      Retry
    </button>
  </div>

  <!-- Content -->
  <div *ngIf="!loading && !error">
    <div class="row">
      <div class="head col-12">
        <h6>Shop</h6>
        <div>
          <a href="#">Home</a>
          <span> > </span>
          <a href="#">Shop</a>
        </div>
      </div>
    </div>
    
    <div class="row">
      <!-- Filters Sidebar -->
      <div class="col-lg-3">
        
<!-- Categories Section -->
<div class="filter-section">
  <div class="filter-header" (click)="toggleFilterSection('category')">
    <h5 class="filter-title">Categories</h5>
    <i class="bi" 
       [class.bi-plus]="!filterSections?.categoryOpen" 
       [class.bi-dash]="filterSections?.categoryOpen"></i>
  </div>
  
  <div class="filter-content" *ngIf="filterSections?.categoryOpen">
    <!-- Loading State -->
    <div *ngIf="loadingCategories" class="text-center py-2">
      <div class="spinner-border spinner-border-sm" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <!-- Categories List -->
    <div *ngIf="!loadingCategories">
      <div class="category-item" *ngFor="let category of categories">
       
        <!-- Parent Category -->
        <div class="category-row" 
             [class.selected]="filters?.selectedCategoryId === category.categoryId"
             [class.has-subcategories]="category.hasSubCategories"
             (click)="toggleCategory(category)">
          
          <span class="category-text">{{category.name}}</span>
          
          <div class="category-actions">
            <!-- Radio for categories without subcategories -->
            <input *ngIf="!category.hasSubCategories"
                   type="radio" 
                   name="category"
                   [checked]="filters?.selectedCategoryId === category.categoryId"
                   (click)="$event.stopPropagation()">
            
            <!-- Expand/Collapse Icon -->
             
            <i *ngIf="category.hasSubCategories" 
               class="bi" 
               [class.bi-chevron-right]="!category.expanded" 
               [class.bi-chevron-down]="category.expanded"></i>
          </div>
        </div>

        <!-- Subcategories -->
        <!-- Subcategories -->
        <div *ngIf="category.expanded && category.hasSubCategories" class="subcategories">
          <!-- Loading Subcategories -->
          <div *ngIf="isLoadingSubcategories(category.categoryId)" class="text-center py-2">
            <div class="spinner-border spinner-border-sm" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>

          <!-- Subcategories List -->
          <div class="subcategory-item" *ngFor="let subcategory of getSubcategories(category.categoryId)">
            <div class="filter-option" 
                [class.selected]="filters?.selectedSubcategoryId == subcategory.categoryId"
                (click)="selectSubcategory(subcategory.categoryId)">
              <input 
                type="radio" 
                name="subcategory"
                [checked]="filters?.selectedSubcategoryId == subcategory.categoryId">
              <span>{{subcategory.name}}</span>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>


       <!-- Categories Section -->

        <!-- Brands Section -->
        <!-- في product-list.html - تحديث قسم البراندات -->

<!-- Brands Section -->
<div class="filter-section">
  <div class="filter-header" (click)="toggleFilterSection('brand')">
    <h5 class="filter-title">Brands</h5>
    <i class="bi" 
       [class.bi-plus]="!filterSections?.brandOpen" 
       [class.bi-dash]="filterSections?.brandOpen"></i>
  </div>
  
  <div class="filter-content" *ngIf="filterSections?.brandOpen">
    <!-- Loading State -->
    <div *ngIf="loadingBrands" class="text-center py-2">
      <div class="spinner-border spinner-border-sm" role="status">
        <span class="visually-hidden">Loading brands...</span>
      </div>
      <div class="small text-muted mt-1">Loading brands...</div>
    </div>

    <!-- Brands List -->
    <div *ngIf="!loadingBrands">
      <!-- Show category info if filtered -->
      <div *ngIf="currentCategoryForBrands" class="small text-muted mb-2">
        Brands for selected category
      </div>
      
      <!-- No brands message -->
      <div *ngIf="brands.length === 0" class="text-muted small py-2">
        No brands available for this category
      </div>
      
      <!-- Brands checkboxes -->
      <div class="filter-option" 
           *ngFor="let brand of brands;"
           [class.selected]="isBrandSelected(brand.id)">
        <input 
          type="checkbox" 
          [id]="'brand-' + brand.id"
          [checked]="isBrandSelected(brand.id)"
          (change)="toggleBrand(brand.id)">
        <label [for]="'brand-' + brand.id" class="brand-label">
          <span class="brand-name">{{brand.name}}</span>
          <span class="brand-count">({{brand.count}})</span>
        </label>
      </div>
    </div>
  </div>
</div>
        <!-- Fabric Colors Section -->
<!-- في product-list.html - تحديث قسم الألوان -->

<!-- Fabric Colors Section -->
<div class="filter-section">
  <div class="filter-header" (click)="toggleFilterSection('fabricColor')">
    <h5 class="filter-title">Fabric Colors</h5>
    <i class="bi" 
       [class.bi-plus]="!filterSections?.fabricColorOpen" 
       [class.bi-dash]="filterSections?.fabricColorOpen"></i>
  </div>
  
  <div class="filter-content" *ngIf="filterSections?.fabricColorOpen">
    <!-- Loading State -->
    <div *ngIf="loadingFabricColors" class="text-center py-2">
      <div class="spinner-border spinner-border-sm" role="status">
        <span class="visually-hidden">Loading colors...</span>
      </div>
      <div class="small text-muted mt-1">Loading fabric colors...</div>
    </div>

    <!-- Fabric Colors List -->
    <div *ngIf="!loadingFabricColors">
      <!-- Show category info if filtered -->
      <div *ngIf="currentCategoryForFabricColors" class="small text-muted mb-2">
        Colors for selected category
      </div>
      
      <!-- No colors message -->
      <div *ngIf="fabricColors.length === 0" class="text-muted small py-2">
        No fabric colors available for this category
      </div>
      
      <!-- Colors grid -->
      <div class="color-grid" *ngIf="fabricColors.length > 0">
        <div class="color-option" 
             *ngFor="let color of fabricColors; ngForTrackBy: trackByColorId"
             [class.selected]="isFabricColorSelected(color.id || color.colorId)"
             (click)="selectFabricColor(color.id || color.colorId)">
          <div class="color-swatch">
            <img [src]="color.imageUrl" 
                 [alt]="color.name || 'Color ' + (color.id || color.colorId)"
                 class="color-image"
                 onerror="this.style.display='none';">
          </div>
          <span class="color-name" *ngIf="color.name">{{color.name}}</span>
        </div>
      </div>
    </div>
  </div>
</div>        

        <!-- Wood Colors Section -->
        <!-- في product-list.html - تحديث قسم Wood Colors -->

<!-- Wood Colors Section -->
<div class="filter-section">
  <div class="filter-header" (click)="toggleFilterSection('woodColor')">
    <h5 class="filter-title">Wood Colors</h5>
    <i class="bi" 
       [class.bi-plus]="!filterSections?.woodColorOpen" 
       [class.bi-dash]="filterSections?.woodColorOpen"></i>
  </div>
  
  <div class="filter-content" *ngIf="filterSections?.woodColorOpen">
    <!-- Loading State -->
    <div *ngIf="loadingWoodColors" class="text-center py-2">
      <div class="spinner-border spinner-border-sm" role="status">
        <span class="visually-hidden">Loading wood colors...</span>
      </div>
      <div class="small text-muted mt-1">Loading wood colors...</div>
    </div>

    <!-- Wood Colors List -->
    <div *ngIf="!loadingWoodColors">
      <!-- Show category info if filtered -->
      <div *ngIf="currentCategoryForWoodColors" class="small text-muted mb-2">
        Wood colors for selected category
      </div>
      
      <!-- No colors message -->
      <div *ngIf="woodColors.length === 0" class="text-muted small py-2">
        No wood colors available for this category
      </div>
      
      <!-- Wood Colors grid -->
      <div class="color-grid" *ngIf="woodColors.length > 0">
        <div class="color-option" 
             *ngFor="let color of woodColors; trackBy: trackByWoodColor"
             [class.selected]="isWoodColorSelected(color.id || color.colorId)"
             (click)="selectWoodColor(color.id || color.colorId)">
          <div class="color-swatch">
            <img [src]="color.imageUrl" 
                 [alt]="color.name || 'Wood Color ' + (color.id || color.colorId)"
                 class="color-image"
                 onerror="this.style.display='none';">
          </div>
          <span class="color-name" *ngIf="color.name">{{color.name}}</span>
        </div>
      </div>
    </div>
  </div>
</div>

        <!-- Price Range Section -->
        <!-- Price Range Section -->



        <!-- Clear Filters Button -->
        <div class="filter-section">
          <button class="btn btn-outline-primary w-100" (click)="clearAllFilters()">
            Clear All Filters
          </button>
        </div>
      </div>

      <!-- Products Column -->
      <div class="col-lg-9">
        <!-- Sort Controls -->
        <div class="sort-by d-flex justify-content-between align-items-center mb-4">
          <div class="results-info">
            <span class="results-count"></span>
          </div>
          <div class="sort-controls d-flex align-items-center">
            <span class="me-2">Sort By:</span>
            <select class="form-select" style="width: auto;" 
                    [(ngModel)]="selectedSort" (change)="onSortChange()">
              <option *ngFor="let option of sortOptions" [value]="option.value">
                {{option.label}}
              </option>
            </select>
          </div>
        </div>
        
        <!-- Products Grid -->
        <!-- Products Grid -->
<div class="row" *ngIf="products.length > 0">
  <div class="col-lg-4 col-md-6 mb-4" *ngFor="let product of products">
    <div class="product-card-wrapper" style="position: relative;">
      <!-- Product Card -->
      <app-product-card 
          [product]="product"
          [showHeartButton]="true"
          [wishlistLists]="wishlistLists"
          [showWishlistDropdown]="false"
          [wishlistStatusLoaded]="true"
          (wishlistChanged)="onProductWishlistChanged($event)">
      </app-product-card>
      <div class="heart-button-overlay">
        <app-product-heart-button
            [productId]="product.productId"
            [size]="'medium'"
            [position]="'top-right'"
            [mode]="'dropdown'"
            [initialWishlistStatus]="product.isWishlisted || product.isInWishlist || false"
            (wishlistToggled)="onProductWishlistChanged({ productId: $event.productId, inWishlist: $event.added })">
        </app-product-heart-button>
      </div>
  
    </div>
  </div>
</div>

<!-- Global Wishlist Dropdown -->
<app-wishlist-dropdown
    *ngIf="showWishlistDropdown && selectedProductForWishlist && (selectedProductForWishlist.productId || selectedProductForWishlist.id)"
    [productId]="selectedProductForWishlist.productId ?? selectedProductForWishlist.id ?? 0"
    [isVisible]="showWishlistDropdown"
    (close)="onWishlistDropdownClose()"
    (itemAdded)="onWishlistItemAdded($event)"
    (itemRemoved)="onWishlistItemRemoved($event)">
</app-wishlist-dropdown>
        <!-- No Products Found -->
        <div *ngIf="products.length === 0" class="text-center py-5">
          <h5>No products found</h5>
          <p>Try adjusting your filters or search terms.</p>
        </div>

        <!-- Pagination -->
        <div class="pagination-container" *ngIf="totalPages > 1">
          <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center">
              <!-- Previous Button -->
              <li class="page-item" [class.disabled]="!hasPreviousPage">
                <a class="page-link" (click)="previousPage()" aria-label="Previous">
                  <span aria-hidden="true">&laquo;</span>
                </a>
              </li>
              
              <!-- First Page -->
              <li class="page-item" *ngIf="getPageNumbers().length > 0 && getPageNumbers()[0] > 1">
                <a class="page-link" (click)="goToPage(1)">1</a>
              </li>
              <li class="page-item" *ngIf="getPageNumbers().length > 0 && getPageNumbers()[0] > 2">
                <span class="page-link">...</span>
              </li>
              
              <!-- Page Numbers -->
              <li class="page-item" *ngFor="let page of getPageNumbers()" 
                  [class.active]="currentPage === page">
                <a class="page-link" (click)="goToPage(page)">{{page}}</a>
              </li>
              
              <!-- Last Page -->
              <li class="page-item" *ngIf="getPageNumbers().length > 0 && getPageNumbers()[getPageNumbers().length - 1] < totalPages - 1">
                <span class="page-link">...</span>
              </li>
              <li class="page-item" *ngIf="getPageNumbers().length > 0 && getPageNumbers()[getPageNumbers().length - 1] < totalPages">
                <a class="page-link" (click)="goToPage(totalPages)">{{totalPages}}</a>
              </li>
              
              <!-- Next Button -->
              <li class="page-item" [class.disabled]="!hasNextPage">
                <a class="page-link" 
                  (click)="hasNextPage ? nextPage() : null" 
                  [style.cursor]="hasNextPage ? 'pointer' : 'not-allowed'"
                  aria-label="Next">
                  <span aria-hidden="true">&raquo;</span>
                </a>
              </li>
            </ul>
          </nav>
          
          <!-- Page Info -->
          <div class="text-center mt-2">
            <small class="text-muted">
              Page {{currentPage}} of {{totalPages}} 
              ({{totalCount}} total products)
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>